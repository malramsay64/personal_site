language: minimal

cache:
  directories:
    - $HOME/.cache/Tectonic
    - $HOME/miniconda
    - $HOME/downloads

before_install:
  - mkdir -p $HOME/downloads
  - mkdir -p $HOME/bin

  - |
    if [ ! -f $HOME/downloads/biber.tar.gz ]; then
      wget https://sourceforge.net/projects/biblatex-biber/files/biblatex-biber/2.5/binaries/Linux/biber-linux_x86_64.tar.gz -O $HOME/downloads/biber.tar.gz
    fi
  - tar xvzf $HOME/downloads/biber.tar.gz -C $HOME/bin
  - mv $HOME/bin/biber $HOME/bin/biber2.5
  - export PATH="$HOME/bin:$PATH"

  - |
    if [ ! -f $HOME/downloads/miniconda.sh ]; then
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O $HOME/downloads/miniconda.sh
    fi
  - bash $HOME/downloads/miniconda.sh -b -u -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r

  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda
  - conda install conda-env
  - conda info -a
  - conda env update
  - source activate thesis

script:
  - make

deploy:
  provider: releases
  api_key:
    # create your own secure code
    secure:
  file: thesis.pdf
  skip_cleanup: true
  on:
    tags: True
